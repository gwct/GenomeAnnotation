from glob import glob
from os.path import basename
import yaml
from os import system

configfile: "/n/home_rc/afreedman/workspace/GenomeAnnotation/Snakemake/config/config.yaml"
res_config = yaml.load(open("/n/home_rc/afreedman/workspace/GenomeAnnotation/Snakemake/config/resources.yaml"),Loader=yaml.FullLoader)

###
if glob("gtflist.txt") == ["gtflist.txt"]:
    system("rm gtflist.txt")
   
SAMPLES = list(set([basename(i.split('/')[-1].split('_')[1]) for i in glob("%s*bam" % config["StringtieBamDir"])]))

for sample in SAMPLES:
   system("echo %s%s_stringtie_%s.gtf >> gtflist.txt" % (config["StringtieAssemblyDir"],sample,config["StringtieAlignmentTool"]))

system("cat gtflist.txt")

### RULES ###

rule all:
    input:
        config["StringtieMergeDir"] + config["StringtieMergeLabel"] + "_stringtie-merge_" + config["StringtieAlignmentTool"] + ".gtf"	

include: "/n/home_rc/afreedman/workspace/GenomeAnnotation/Snakemake/rules/stringtie.smk"
